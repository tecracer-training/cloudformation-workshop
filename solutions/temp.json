{
  "AWSTemplateFormatVersion" : "2010-09-09",
  "Description" : "cfn-init sample ...",
  "Parameters" : {
     "Resources" : {
      "WebServerInstance": {
        "Type": "AWS::EC2::Instance",
        "Metadata" : {
          "Comment1" : "Configure the bootstrap helpers to install e. g. webserver, mysql ...",
          "Comment2" : "Save website content to /var/www/html/index.php",

          "AWS::CloudFormation::Init" : {
            "configSets" : {
              "Install" : [ "Install" ]
            },
            "Install" : {
              "packages" : {
                "yum" : {
                  "mysql"        : [],
                  "httpd"        : []
                }
              },

              "files" : {
                "/var/www/html/index.php" : {
                  "content" : { "Fn::Join" : [ "", [
                    "<html>\n",
                    "  ...  code of index.php file goes here ...
                    "</html>\n"
                  ]]},
                  "mode"  : "000600",
                  "owner" : "apache",
                  "group" : "apache"
                },
                "services" : {
                  "sysvinit" : {
                    "httpd"   : { "enabled" : "true", "ensureRunning" : "true" }
                  }
                }
              }
            },
            "Properties": {
              "ImageId" : { ... },
              "UserData"       : { "Fn::Base64" : { "Fn::Join" : ["", [
                "#!/bin/bash -xe\n",
                "yum update -y aws-cfn-bootstrap\n",

                "# Install the files and packages from the metadata\n",
                "/opt/aws/bin/cfn-init -v ",
                "         --stack ", { "Ref" : "AWS::StackName" },
                "         --resource WebServerInstance ",
                "         --configsets Install ",
                "         --region ", { "Ref" : "AWS::Region" }, "\n"
              ]]}}
            }
          },
          "WebServerSecurityGroup" : { ...  }
        },
        "Outputs" : { ... }
      }